<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <span class="navbar-brand">订单详情（配送单）</span>
            <button type="button" class="btn btn-default navbar-btn" ui-sref="today-order-list({statusValue:backParams})" style="padding-left: 10px;">
                <span class="glyphicon glyphicon-menu-left back-left" aria-hidden="true"></span>返回
            </button>
        </div>
    </div>
</nav>

<div class="container-fluid">
	<div class="row" ng-if="order">
	     <div class="col-lg-12 dataTable_wrapper">
	     	<div class="panel panel-default">
	     		<div class="panel-heading">
                    <strong style="font-size: 17px;">餐馆：{{order.restaurant.name}}</strong>
                    <button type="button" class="btn btn-default" style="float: right; margin-top: -5px; margin-right: -5px; color: #286090; border-color: #286090;" ng-click="toRedressLocation()">修正坐标</button>
                </div>
                <table class="table table-bordered">
                 	<tbody>
                 		<tr>
                 			<td>出库单ID：{{order.id}}</td>
                 		</tr>
                 		<tr>
                            <td>餐馆ID：{{order.restaurant.id}}</td>
                 		</tr>
                 		<tr>
                 			<td>餐馆名称：{{order.restaurant.name}}</td>
                 		</tr>
                        <tr>
                            <td>下单时间：{{order.submitDate | date : "yyyy-MM-dd HH:mm:ss"}}</td>
                        </tr>
                        <tr>
                            <td>销售客服：{{order.customer.adminUser.realname}}</td>
                        </tr>
                        <tr>
                            <td>客服电话：<span ng-click="toConfirmYesNo(0,order.customer.adminUser.telephone)">{{order.customer.adminUser.telephone}}</span></td>
                        </tr>
                 	</tbody>
                </table>
	     	</div>
	     </div>
	</div>

	<div class="row" ng-if="order.orderItems && order.orderItems.length > 0">
        <div class="col-lg-12 dataTable_wrapper">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <strong style="font-size: 17px;">订单明细</strong>
                </div>
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th style="vertical-align: middle;">商品名称</th>
                            <th style="vertical-align: middle;">单价</th>
                            <th>数量</th>
                            <th style="vertical-align: middle;">总价</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="orderItem in order.orderItems">
                            <td>{{orderItem.sku.name}}</td>
                            <td style="vertical-align: middle;">{{orderItem.price | currency : "￥"}}</td>
                            <td style="vertical-align: middle; text-align: center;">{{orderItem.quantity}}</td>
                            <td style="vertical-align: middle;">{{orderItem.totalPrice | currency : "￥"}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="row" ng-if="order.promotions && order.promotions.length > 0">
        <div class="col-lg-12 dataTable_wrapper">
            <div class="panel panel-warning">
                <div class="panel-heading">
                    <strong style="font-size: 17px;">优惠明细</strong>
                </div>
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th style="vertical-align: middle;">优惠详情</th>
                            <th>数量</th>
                            <th>减免/赠送商品</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="promotion in order.promotions">
                            <td style="vertical-align: middle;">{{promotion.description}}</td>
                            <td style="vertical-align: middle; text-align: center;">{{promotion.quantity}}</td>
                            <td style="vertical-align: middle;">
                                <span ng-if="promotion.discount !== 0">-{{promotion.discount | currency : "￥"}}</span>
                                <span ng-if="promotion.sku.name">{{promotion.sku.name}}</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="row" ng-if="order.customerCoupons && order.customerCoupons.length > 0">
        <div class="col-lg-12 dataTable_wrapper">
            <div class="panel panel-success">
                <div class="panel-heading">
                    <strong style="font-size: 17px;">无忧券明细</strong>
                </div>
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>优惠券类型</th>
                            <th>优惠券标题</th>
                            <th style="vertical-align: middle;">使用条件</th>
                            <th>减免/赠送商品</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="customerCoupon in order.customerCoupons">
                            <td>{{customerCoupon.coupon.type.name}}</td>
                            <td style="vertical-align: middle;">{{customerCoupon.coupon.description}}</td>
                            <td>{{customerCoupon.coupon.remark}}</td>
                            <td style="vertical-align: middle;">
                                <span ng-if="customerCoupon.coupon.discount">-{{customerCoupon.coupon.discount | currency : "￥"}}</span>
                                <span ng-if="customerCoupon.coupon.sku.name">{{customerCoupon.coupon.sku.name}}</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="row" ng-if="order.memo">
        <div class="col-lg-12 dataTable_wrapper">
            <div class="panel panel-danger">
                <div class="panel-heading">
                    <strong style="font-size: 17px;">备注信息</strong>
                </div>
                <table class="table table-striped table-bordered">
                    <tbody>
                        <tr>
                            <td>{{order.memo}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- <div class="row" ng-if="order.status.value !== 2 && collectionments.length > 0">
        <div class="col-lg-12 dataTable_wrapper">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <strong style="font-size: 17px;">结款方式</strong>
                    <button type="button" class="btn btn-default" style="float: right; margin-top: -5px; margin-right: -5px; color: #286090; border-color: #286090;" ng-click="add(null)">
                        <span class="glyphicon glyphicon-plus back-left" aria-hidden="true" style="margin-right: 2px;"></span>添加
                    </button>
                </div>
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th style="width: 40%;">收款方式</th>
                            <th style="width: 40%;">收款金额</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="collectionment in collectionments">
                            <td>
                                <select class="form-control" ng-model="collectionment.collectionPaymentMethodId" ng-options="method.id as method.name for method in methods" style="padding-left: 6px;">
                                </select>
                            </td>
                            <td>
                                <input type="number" name="amount_{{$index}}" class="form-control" ng-model="collectionment.amount"/>
                            </td>
                            <td>
                                <button type="button" ng-click="remove($index)" class="btn btn-danger" ng-disabled="$first">删除</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div> -->

    <div class="row" ng-if="order">
        <div class="custome-label" style="padding-left: 8px;">订单总金额：
            <span style="color:red;">{{order.total | currency : "￥"}}</span>
        </div>
        <div class="custome-label check-tip">（请确认商品配送及账款收取无误）</div>

        <button class="btn btn-default custom-btn" style="border-color: #398439; color: #398439;" ng-disabled="order.status.value === 2" ng-click="toStockOut()">退货操作</button>
    </div>

    <br>
    <div class="row" style="text-align: center; margin-bottom: 4px;" ng-if="order">
        <button class="btn btn-lg btn-success" style="width: 95%;" ng-click="toConfirmYesNo(order,0);" ng-if="order.status.value !== 2" ng-disabled="isConfirmProcess">配送完成</button>
        <button class="btn btn-lg btn-success" style="width: 95%;" ng-if="order.status.value === 2" disabled>已配送完成</button> 
    </div>
    <br>
</div>

<div id="modalConfirmYesNo" class="modal fade">
    <div class="modal-dialog" style="margin-top: 60%;">
        <div class="modal-content">
            <div class="modal-body">
                <p id="lblMsgConfirmYesNo"></p>
            </div>
            <div class="modal-footer">
                <button id="btnNoConfirmYesNo" type="button" class="btn btn-default">取消</button>
                <button id="btnYesConfirmYesNo" type="button" class="btn btn-primary">确认</button>
            </div>
        </div>
    </div>
</div>